<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPTV Pro Player (Plyr Edition)</title>
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© (Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†) */
            --primary-color: #e50914;
            --bg-dark: #0f0f0f;
            --bg-panel: #161616;
            --text-color: #e0e0e0;
            --text-secondary: #888;
            --hover-color: #333;
            --border-color: #2a2a2a;
            --input-bg: #111;
            --input-border: #444;
            --header-height: 60px;
            --footer-height: 40px;
            
            /* Ø£Ù„ÙˆØ§Ù† Ù…Ø´ØºÙ„ Plyr Ù„ØªØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ø§Ù„Ø«ÙŠÙ… */
            --plyr-color-main: #e50914;
        }

        /* Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­ (Light Mode) */
        body.light-mode {
            --bg-dark: #ffffff;
            --bg-panel: #f4f4f4;
            --text-color: #333;
            --text-secondary: #666;
            --hover-color: #e0e0e0;
            --border-color: #ccc;
            --input-bg: #fff;
            --input-border: #ccc;
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-color);
            font-family: 'Cairo', sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: background-color 0.3s, color 0.3s;
        }

        /* --- Header --- */
        header {
            height: var(--header-height);
            background-color: var(--bg-panel);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            box-sizing: border-box;
            flex-shrink: 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-color);
        }

        .logo svg {
            fill: var(--primary-color);
            width: 24px;
            height: 24px;
        }

        .theme-toggle {
            background: none;
            border: 1px solid var(--border-color);
            color: var(--text-color);
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 20px;
            font-family: inherit;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: 0.3s;
            font-size: 0.9rem;
        }

        .theme-toggle:hover {
            background-color: var(--hover-color);
        }

        /* --- Ù‚Ø³Ù… Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (ØªØ¹Ø¯ÙŠÙ„Ø§Øª Plyr) --- */
        .video-section {
            width: 100%;
            background: #000;
            flex-shrink: 0;
            position: relative;
            z-index: 10;
        }

        /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù„Ø¬Ø¹Ù„Ù‡Ø§ Ù…ØªØ¬Ø§ÙˆØ¨Ø© */
        .video-wrapper {
            width: 100%;
            height: 100%;
            max-height: 40vh; /* ØªÙ… ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„Ø¥Ø¹Ø·Ø§Ø¡ Ù…Ø³Ø§Ø­Ø© Ù„Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
            margin: 0 auto;
        }
        
        @media (min-height: 800px) {
             .video-wrapper { max-height: 50vh; }
        }

        /* ØªØ®ØµÙŠØµ Plyr Ù„ÙŠÙ…Ù„Ø£ Ø§Ù„Ø­Ø§ÙˆÙŠØ© */
        .plyr {
            height: 100%;
            width: 100%;
        }
        
        video {
            object-fit: contain; 
        }

        /* --- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ --- */
        .main-content {
            display: flex;
            flex: 1; /* ÙŠØ£Ø®Ø° Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ù„ÙƒÙ† Ø³Ù†Ù‚ÙˆÙ… Ø¨ØªÙ‚ÙŠÙŠØ¯Ù‡Ø§ */
            height: 40vh; /* ØªØ­Ø¯ÙŠØ¯ Ø§Ø±ØªÙØ§Ø¹ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© */
            overflow: hidden;
            border-top: 2px solid var(--primary-color);
            border-bottom: 1px solid var(--border-color);
        }

        .list-section {
            display: flex;
            flex-direction: column;
            overflow: hidden;
            height: 100%;
        }

        .countries-list {
            width: 35%;
            background: var(--bg-panel);
            border-left: 1px solid var(--border-color);
            transition: background 0.3s;
        }

        .channels-list {
            width: 65%;
            background: var(--bg-dark);
            transition: background 0.3s;
        }

        /* Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¨Ø­Ø« */
        .search-box {
            padding: 12px;
            background: var(--bg-panel);
            border-bottom: 1px solid var(--border-color);
        }

        .search-box input {
            width: 100%;
            padding: 10px 12px;
            border-radius: 6px;
            border: 1px solid var(--input-border);
            background: var(--input-bg);
            color: var(--text-color);
            box-sizing: border-box;
            outline: none;
            transition: 0.3s;
        }

        .search-box input:focus {
            border-color: var(--primary-color);
        }

        /* Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… */
        .scrollable-list {
            flex: 1;
            overflow-y: auto;
            padding-bottom: 20px;
        }

        .item {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: all 0.2s;
        }

        .item:hover {
            background-color: var(--hover-color);
        }

        .item.active {
            background-color: rgba(229, 9, 20, 0.15);
            border-right: 3px solid var(--primary-color);
        }
        
        body.light-mode .item.active {
            background-color: rgba(229, 9, 20, 0.1);
        }

        .item img {
            width: 28px;
            height: 28px;
            margin-left: 12px;
            border-radius: 50%;
            object-fit: contain;
            background: #000;
            border: 1px solid #333;
        }

        .item span {
            font-size: 14px;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .status-msg {
            text-align: center;
            padding: 30px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* --- Ù‚Ø³Ù… ÙƒØ±Ø© Ø§Ù„Ù‚Ø¯Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ --- */
        .football-section {
            flex: 1;
            overflow-y: auto; /* ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø·ÙˆÙŠÙ„Ø§Ù‹ */
            background-color: var(--bg-dark);
            padding: 10px;
            border-top: 5px solid var(--bg-panel);
        }
        
        .football-header {
            display: flex;
            align-items: center;
            justify-content: center;
            padding-bottom: 10px;
            color: var(--primary-color);
            font-weight: bold;
        }

        /* --- Footer --- */
        footer {
            height: var(--footer-height);
            background-color: var(--bg-panel);
            border-top: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-panel); }
        ::-webkit-scrollbar-thumb { background: #555; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary-color); }

        @media (max-width: 768px) {
            .countries-list { width: 40%; }
            .channels-list { width: 60%; }
            .item { padding: 10px; }
            .logo span { display: none; }
            .logo svg { width: 30px; height: 30px; }
            /* ÙÙŠ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ Ù†Ø¬Ø¹Ù„ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø£Ù‚ØµØ± Ù„Ù†Ø¸Ù‡Ø± Ø§Ù„ÙƒØ±Ø© */
            .main-content { height: 35vh; }
        }
    </style>
</head>
<body>

    <header>
        <div class="logo">
            <svg viewBox="0 0 24 24">
                <path d="M21 3H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h5v2h8v-2h5c1.1 0 1.99-.9 1.99-2L23 5c0-1.1-.9-2-2-2zm0 14H3V5h18v12z"/>
            </svg>
            <span>IPTV Player</span>
        </div>
        <button class="theme-toggle" id="theme-btn" onclick="toggleTheme()">
            <span id="theme-icon">â˜€ï¸</span> 
            <span id="theme-text">Light Mode</span>
        </button>
    </header>

    <div class="video-section">
        <div class="video-wrapper">
            <video id="player" playsinline controls crossorigin>
                <source src="" type="application/x-mpegURL" />
            </video>
        </div>
    </div>

    <div class="main-content">
        <div class="list-section countries-list">
            <div class="search-box">
                <input type="text" id="search-country" placeholder="Ø¨Ø­Ø« Ø¹Ù† Ø¯ÙˆÙ„Ø©..." onkeyup="filterList('countries-container', this.value)">
            </div>
            <div id="countries-container" class="scrollable-list">
                <div class="status-msg">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯ÙˆÙ„...</div>
            </div>
        </div>

        <div class="list-section channels-list">
            <div class="search-box">
                <input type="text" id="search-channel" placeholder="Ø¨Ø­Ø« Ø¹Ù† Ù‚Ù†Ø§Ø©..." onkeyup="filterList('channels-container', this.value)">
            </div>
            <div id="channels-container" class="scrollable-list">
                <div class="status-msg">ğŸ‘ˆ Ø§Ø®ØªØ± Ø¯ÙˆÙ„Ø© Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ø¹Ø±Ø¶ Ù‚Ù†ÙˆØ§ØªÙ‡Ø§</div>
            </div>
        </div>
    </div>

    <div class="football-section">
        <div class="football-header">âš½ Ù†ØªØ§Ø¦Ø¬ ÙˆØ¯ÙˆØ±ÙŠØ§Øª ÙƒØ±Ø© Ø§Ù„Ù‚Ø¯Ù…</div>
        
        <div id="api-football-container">
            <api-sports-widget data-type="leagues"></api-sports-widget>
            <api-sports-widget data-type="config"
                data-key="219afb927d14c7f9ba7132adf83e0a4f"
                data-sport="football"
                data-lang="en"
                data-theme="dark"
                data-show-errors="true"
            ></api-sports-widget>
        </div>
    </div>

    <footer>
        Copyright &copy; Ø¹Ù…Ø§Ø¯ Ø§Ù„Ø¯ÙŠÙ† Ù„Ù…Ø±Ø§Ù†ÙŠ
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>
    <script type="module" src="https://widgets.api-sports.io/2.0.3/widgets.js"></script>

    <script>
        const countriesContainer = document.getElementById('countries-container');
        const channelsContainer = document.getElementById('channels-container');
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ Plyr Ù…Ø¹ Hls.js
        const videoElement = document.getElementById('player');
        let player;
        let hls;

        // Ø¯Ø§Ù„Ø© Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø´ØºÙ„
        function initPlayer(sourceUrl) {
            if (Hls.isSupported()) {
                if(hls) {
                    hls.destroy(); 
                }
                hls = new Hls();
                hls.loadSource(sourceUrl);
                hls.attachMedia(videoElement);
                
                hls.on(Hls.Events.MANIFEST_PARSED, function() {
                    if (!player) {
                        player = new Plyr(videoElement, {
                            controls: ['play-large', 'play', 'progress', 'current-time', 'mute', 'volume', 'settings', 'pip', 'airplay', 'fullscreen'],
                            settings: ['quality', 'speed']
                        });
                    }
                    videoElement.play().catch(e => console.log("Auto-play blocked"));
                });
                
                hls.on(Hls.Events.ERROR, function (event, data) {
                    if (data.fatal) {
                        switch (data.type) {
                            case Hls.ErrorTypes.NETWORK_ERROR:
                                hls.startLoad();
                                break;
                            case Hls.ErrorTypes.MEDIA_ERROR:
                                hls.recoverMediaError();
                                break;
                            default:
                                hls.destroy();
                                break;
                        }
                    }
                });

            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = sourceUrl;
                if (!player) {
                    player = new Plyr(videoElement);
                }
                videoElement.play();
            }
        }

        let allCountries = [];

        // --- ÙˆØ¸ÙŠÙØ© ØªØºÙŠÙŠØ± Ø§Ù„Ø«ÙŠÙ… (Ù…Ø­Ø¯Ø«Ø© Ù„ØªØ´Ù…Ù„ ÙˆÙŠØ¯Ø¬Øª Ø§Ù„ÙƒØ±Ø©) ---
        function toggleTheme() {
            const body = document.body;
            const btnText = document.getElementById('theme-text');
            const btnIcon = document.getElementById('theme-icon');
            
            // Ø¹Ù†ØµØ± Ø§Ù„ØªÙƒÙˆÙŠÙ† Ø§Ù„Ø®Ø§Øµ Ø¨ÙˆÙŠØ¯Ø¬Øª Ø§Ù„ÙƒØ±Ø©
            const widgetConfig = document.querySelector('api-sports-widget[data-type="config"]');
            
            body.classList.toggle('light-mode');
            
            if (body.classList.contains('light-mode')) {
                // ÙˆØ¶Ø¹ Ù†Ù‡Ø§Ø±ÙŠ
                btnText.textContent = "Dark Mode";
                btnIcon.textContent = "ğŸŒ™";
                // ØªØºÙŠÙŠØ± Ø«ÙŠÙ… Ø§Ù„ÙˆÙŠØ¯Ø¬Øª Ù„Ù„Ø£Ø¨ÙŠØ¶
                if(widgetConfig) widgetConfig.setAttribute('data-theme', 'white');
            } else {
                // ÙˆØ¶Ø¹ Ù„ÙŠÙ„ÙŠ
                btnText.textContent = "Light Mode";
                btnIcon.textContent = "â˜€ï¸";
                // ØªØºÙŠÙŠØ± Ø«ÙŠÙ… Ø§Ù„ÙˆÙŠØ¯Ø¬Øª Ù„Ù„Ø¯Ø§ÙƒÙ†
                if(widgetConfig) widgetConfig.setAttribute('data-theme', 'dark');
            }
        }

        // --- Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ---
        async function fetchCountries() {
            try {
                const response = await fetch('https://iptv-org.github.io/api/countries.json');
                const data = await response.json();
                allCountries = data.sort((a, b) => a.name.localeCompare(b.name));
                renderCountries(allCountries);
            } catch (error) {
                countriesContainer.innerHTML = '<div class="status-msg">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„</div>';
            }
        }

        function renderCountries(list) {
            countriesContainer.innerHTML = '';
            list.forEach(country => {
                if (country.name && country.code) {
                    const div = document.createElement('div');
                    div.className = 'item';
                    div.innerHTML = `
                        <img src="https://flagcdn.com/w40/${country.code.toLowerCase()}.png" loading="lazy" onerror="this.src='https://via.placeholder.com/20'">
                        <span>${country.name}</span>
                    `;
                    div.onclick = () => loadCountryChannels(country.code, country.name, div);
                    div.setAttribute('data-name', country.name.toLowerCase());
                    countriesContainer.appendChild(div);
                }
            });
        }

        async function loadCountryChannels(code, name, element) {
            document.querySelectorAll('.countries-list .item').forEach(i => i.classList.remove('active'));
            element.classList.add('active');

            channelsContainer.innerHTML = `<div class="status-msg">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ù„Ù€ ${name}...</div>`;
            document.getElementById('search-channel').value = '';

            try {
                const m3uUrl = `https://iptv-org.github.io/iptv/countries/${code.toLowerCase()}.m3u`;
                const response = await fetch(m3uUrl);
                if (!response.ok) throw new Error("No channels");
                const m3uText = await response.text();
                const channels = parseM3U(m3uText);

                if (channels.length === 0) {
                    channelsContainer.innerHTML = '<div class="status-msg">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ù†ÙˆØ§Øª Ù…ØªØ§Ø­Ø©.</div>';
                } else {
                    renderChannels(channels);
                }
            } catch (error) {
                channelsContainer.innerHTML = '<div class="status-msg">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ù†ÙˆØ§Øª Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø¯ÙˆÙ„Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.</div>';
            }
        }

        function parseM3U(content) {
            const lines = content.split('\n');
            const channels = [];
            let currentChannel = {};

            for (let line of lines) {
                line = line.trim();
                if (line.startsWith('#EXTINF:')) {
                    const logoMatch = line.match(/tvg-logo="([^"]*)"/);
                    const logo = logoMatch ? logoMatch[1] : '';
                    const nameParts = line.split(',');
                    const name = nameParts[nameParts.length - 1].trim();
                    currentChannel = { name: name, logo: logo };
                } else if (line.startsWith('http')) {
                    currentChannel.url = line;
                    channels.push(currentChannel);
                    currentChannel = {};
                }
            }
            return channels;
        }

        function renderChannels(channels) {
            channelsContainer.innerHTML = '';
            channels.forEach(channel => {
                const div = document.createElement('div');
                div.className = 'item';
                div.innerHTML = `
                    <img src="${channel.logo}" loading="lazy" onerror="this.src='https://via.placeholder.com/40?text=TV'">
                    <span>${channel.name}</span>
                `;
                div.onclick = () => playStream(channel.url);
                div.setAttribute('data-name', channel.name.toLowerCase());
                channelsContainer.appendChild(div);
            });
        }

        function playStream(url) {
            if (!url) return;
            initPlayer(url);
        }

        function filterList(containerId, query) {
            const container = document.getElementById(containerId);
            const items = container.getElementsByClassName('item');
            const searchText = query.toLowerCase();
            for (let item of items) {
                const name = item.getAttribute('data-name');
                if (name && name.includes(searchText)) item.style.display = 'flex';
                else item.style.display = 'none';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
             player = new Plyr(videoElement, {
                controls: ['play-large', 'play', 'progress', 'current-time', 'mute', 'volume', 'fullscreen']
            });
            fetchCountries();
        });
    </script>
</body>
</html>
