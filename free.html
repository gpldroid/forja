<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>IPTV Pro Player</title>
    
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© (Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†) */
            --primary-color: #e50914;
            --bg-dark: #0f0f0f;
            --bg-panel: #161616;
            --text-color: #e0e0e0;
            --text-secondary: #888;
            --hover-color: #333;
            --border-color: #2a2a2a;
            --input-bg: #111;
            --input-border: #444;
            --header-height: 60px;
            --footer-height: 40px;
            
            /* Ø£Ù„ÙˆØ§Ù† Ù…Ø´ØºÙ„ Plyr */
            --plyr-color-main: #e50914;
        }

        /* Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­ (Light Mode) */
        body.light-mode {
            --bg-dark: #ffffff;
            --bg-panel: #f4f4f4;
            --text-color: #333;
            --text-secondary: #666;
            --hover-color: #e0e0e0;
            --border-color: #ccc;
            --input-bg: #fff;
            --input-border: #ccc;
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-color);
            font-family: 'Cairo', sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            height: 100dvh; 
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: background-color 0.3s, color 0.3s;
        }

        /* --- Header --- */
        header {
            height: var(--header-height);
            background-color: var(--bg-panel);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            box-sizing: border-box;
            flex-shrink: 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-color);
        }

        .logo svg {
            fill: var(--primary-color);
            width: 24px;
            height: 24px;
        }

        .theme-toggle {
            background: none;
            border: 1px solid var(--border-color);
            color: var(--text-color);
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 20px;
            font-family: inherit;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: 0.3s;
            font-size: 0.9rem;
        }

        .theme-toggle:hover {
            background-color: var(--hover-color);
        }

        /* --- Ù‚Ø³Ù… Ø§Ù„ÙÙŠØ¯ÙŠÙˆ --- */
        .video-section {
            width: 100%;
            background: #000;
            flex-shrink: 0;
            position: relative;
            z-index: 10;
        }

        .video-wrapper {
            width: 100%;
            margin: 0 auto;
            max-height: 40vh;
        }
        
        @media (min-height: 800px) {
             .video-wrapper { max-height: 45vh; }
        }

        .plyr {
            height: 100%;
            width: 100%;
        }

        /* --- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ --- */
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
            border-top: 2px solid var(--primary-color);
            /* ØªÙ‚Ù„ÙŠØµ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨Ø¸Ù‡ÙˆØ± Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª */
            min-height: 0; 
        }

        .list-section {
            display: flex;
            flex-direction: column;
            overflow: hidden;
            height: 100%;
        }

        .countries-list {
            width: 35%;
            background: var(--bg-panel);
            border-left: 1px solid var(--border-color);
            transition: background 0.3s;
        }

        .channels-list {
            width: 65%;
            background: var(--bg-dark);
            transition: background 0.3s;
        }

        /* Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¨Ø­Ø« */
        .search-box {
            padding: 12px;
            background: var(--bg-panel);
            border-bottom: 1px solid var(--border-color);
        }

        .search-box input {
            width: 100%;
            padding: 10px 12px;
            border-radius: 6px;
            border: 1px solid var(--input-border);
            background: var(--input-bg);
            color: var(--text-color);
            box-sizing: border-box;
            outline: none;
            transition: 0.3s;
        }

        .search-box input:focus {
            border-color: var(--primary-color);
        }

        /* Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… */
        .scrollable-list {
            flex: 1;
            overflow-y: auto;
            padding-bottom: 20px;
            -webkit-overflow-scrolling: touch;
        }

        .item {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: all 0.2s;
        }

        .item:hover {
            background-color: var(--hover-color);
        }

        .item.active {
            background-color: rgba(229, 9, 20, 0.15);
            border-right: 3px solid var(--primary-color);
        }
        
        body.light-mode .item.active {
            background-color: rgba(229, 9, 20, 0.1);
        }

        .item img {
            width: 28px;
            height: 28px;
            margin-left: 12px;
            border-radius: 50%;
            object-fit: contain;
            background: #000;
            border: 1px solid #333;
        }

        .item span {
            font-size: 14px;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .status-msg {
            text-align: center;
            padding: 30px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* --- Ù‚Ø³Ù… Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª (Ø¬Ø¯ÙŠØ¯) --- */
        .matches-section {
            background-color: var(--bg-panel);
            border-top: 1px solid var(--border-color);
            padding: 10px 20px;
            flex-shrink: 0;
            height: 140px; /* Ø§Ø±ØªÙØ§Ø¹ Ø«Ø§Ø¨Øª Ù„Ù„Ù‚Ø³Ù… */
            display: flex;
            flex-direction: column;
        }

        .matches-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 14px;
            font-weight: 700;
            color: var(--primary-color);
        }

        .matches-scroll {
            display: flex;
            gap: 15px;
            overflow-x: auto;
            padding-bottom: 5px;
            scrollbar-width: thin;
        }

        .match-card {
            background: var(--input-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 8px 15px;
            min-width: 220px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: 0.2s;
            cursor: pointer;
        }

        .match-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }

        .match-team {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            width: 70px;
        }

        .match-team img {
            width: 30px;
            height: 30px;
            object-fit: contain;
        }

        .match-team span {
            font-size: 11px;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
        }

        .match-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .match-time {
            color: var(--primary-color);
            background: rgba(229, 9, 20, 0.1);
            padding: 2px 8px;
            border-radius: 4px;
            margin-bottom: 4px;
        }

        .live-badge {
            background: var(--primary-color);
            color: #fff;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* --- Footer --- */
        footer {
            height: var(--footer-height);
            background-color: var(--bg-panel);
            border-top: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            font-size: 0.9rem;
            flex-shrink: 0;
            z-index: 50;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-panel); }
        ::-webkit-scrollbar-thumb { background: #555; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary-color); }

        @media (max-width: 768px) {
            .countries-list { width: 40%; }
            .channels-list { width: 60%; }
            .item { padding: 10px; }
            .logo span { display: none; }
            .logo svg { width: 30px; height: 30px; }
            
            /* ØªØ­Ø³ÙŠÙ† Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
            .matches-section { height: auto; min-height: 130px; }
            .match-card { min-width: 200px; padding: 10px; }
        }
    </style>
</head>
<body>

    <header>
        <div class="logo">
            <svg viewBox="0 0 24 24">
                <path d="M21 3H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h5v2h8v-2h5c1.1 0 1.99-.9 1.99-2L23 5c0-1.1-.9-2-2-2zm0 14H3V5h18v12z"/>
            </svg>
            <span>IPTV Player</span>
        </div>
        <button class="theme-toggle" id="theme-btn" onclick="toggleTheme()">
            <span id="theme-icon">â˜€ï¸</span> 
            <span id="theme-text">Light Mode</span>
        </button>
    </header>

    <div class="video-section">
        <div class="video-wrapper">
            <video id="player" playsinline controls crossorigin>
                <source src="" type="application/x-mpegURL" />
            </video>
        </div>
    </div>

    <div class="main-content">
        <div class="list-section countries-list">
            <div class="search-box">
                <input type="text" id="search-country" placeholder="Ø¨Ø­Ø« Ø¹Ù† Ø¯ÙˆÙ„Ø©..." onkeyup="filterList('countries-container', this.value)">
            </div>
            <div id="countries-container" class="scrollable-list">
                <div class="status-msg">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯ÙˆÙ„...</div>
            </div>
        </div>

        <div class="list-section channels-list">
            <div class="search-box">
                <input type="text" id="search-channel" placeholder="Ø¨Ø­Ø« Ø¹Ù† Ù‚Ù†Ø§Ø©..." onkeyup="filterList('channels-container', this.value)">
            </div>
            <div id="channels-container" class="scrollable-list">
                <div class="status-msg">ğŸ‘ˆ Ø§Ø®ØªØ± Ø¯ÙˆÙ„Ø© Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</div>
            </div>
        </div>
    </div>

    <div class="matches-section">
        <div class="matches-header">
            <span>âš½ Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©</span>
            <span style="font-size: 12px; color: var(--text-secondary); cursor: pointer;">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</span>
        </div>
        <div class="matches-scroll" id="matches-wrapper">
            <div class="status-msg" style="width: 100%;">Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„...</div>
        </div>
    </div>

    <footer>
        <p>
        Copyright &copy; Ø¹Ù…Ø§Ø¯ Ø§Ù„Ø¯ÙŠÙ† Ù„Ù…Ø±Ø§Ù†ÙŠ
        </p>    
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>

    <script>
        const countriesContainer = document.getElementById('countries-container');
        const channelsContainer = document.getElementById('channels-container');
        const videoElement = document.getElementById('player');
        
        let player;
        let hls;
        let allCountries = [];

        // --- Ø¯Ø§Ù„Ø© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø´ØºÙ„ (Plyr + Hls.js) ---
        function initPlayer(sourceUrl) {
            if (Hls.isSupported()) {
                if (hls) {
                    hls.destroy();
                }
                hls = new Hls();
                hls.loadSource(sourceUrl);
                hls.attachMedia(videoElement);
                
                hls.on(Hls.Events.MANIFEST_PARSED, function() {
                    if (!player) {
                        player = new Plyr(videoElement, {
                            controls: ['play-large', 'play', 'progress', 'current-time', 'mute', 'volume', 'settings', 'pip', 'airplay', 'fullscreen'],
                            settings: ['quality', 'speed']
                        });
                    }
                    videoElement.play().catch(() => console.log("User interaction required for playback"));
                });

                hls.on(Hls.Events.ERROR, function (event, data) {
                    if (data.fatal) {
                        switch (data.type) {
                            case Hls.ErrorTypes.NETWORK_ERROR:
                                hls.startLoad();
                                break;
                            case Hls.ErrorTypes.MEDIA_ERROR:
                                hls.recoverMediaError();
                                break;
                            default:
                                hls.destroy();
                                break;
                        }
                    }
                });
            } 
            // Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ØªÙŠ ØªØ¯Ø¹Ù… HLS Ø·Ø¨ÙŠØ¹ÙŠØ§Ù‹ (Ù…Ø«Ù„ Safari)
            else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = sourceUrl;
                if (!player) {
                    player = new Plyr(videoElement);
                }
                videoElement.play();
            }
        }

        // --- Ø¯Ø§Ù„Ø© ØªØºÙŠÙŠØ± Ø§Ù„Ø«ÙŠÙ… ---
        function toggleTheme() {
            const body = document.body;
            const btnText = document.getElementById('theme-text');
            const btnIcon = document.getElementById('theme-icon');
            
            body.classList.toggle('light-mode');
            
            if (body.classList.contains('light-mode')) {
                btnText.textContent = "Dark Mode";
                btnIcon.textContent = "ğŸŒ™";
            } else {
                btnText.textContent = "Light Mode";
                btnIcon.textContent = "â˜€ï¸";
            }
        }

        // --- Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ---
        async function fetchCountries() {
            try {
                const response = await fetch('https://iptv-org.github.io/api/countries.json');
                const data = await response.json();
                allCountries = data.sort((a, b) => a.name.localeCompare(b.name));
                renderCountries(allCountries);
            } catch (error) {
                countriesContainer.innerHTML = '<div class="status-msg">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„</div>';
            }
        }

        function renderCountries(list) {
            countriesContainer.innerHTML = '';
            list.forEach(country => {
                if (country.name && country.code) {
                    const div = document.createElement('div');
                    div.className = 'item';
                    div.innerHTML = `
                        <img src="https://flagcdn.com/w40/${country.code.toLowerCase()}.png" loading="lazy" onerror="this.src='https://via.placeholder.com/20'">
                        <span>${country.name}</span>
                    `;
                    div.onclick = () => loadCountryChannels(country.code, country.name, div);
                    div.setAttribute('data-name', country.name.toLowerCase());
                    countriesContainer.appendChild(div);
                }
            });
        }

        async function loadCountryChannels(code, name, element) {
            document.querySelectorAll('.countries-list .item').forEach(i => i.classList.remove('active'));
            element.classList.add('active');

            channelsContainer.innerHTML = `<div class="status-msg">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ù„Ù€ ${name}...</div>`;
            document.getElementById('search-channel').value = '';

            try {
                const m3uUrl = `https://iptv-org.github.io/iptv/countries/${code.toLowerCase()}.m3u`;
                const response = await fetch(m3uUrl);
                if (!response.ok) throw new Error("No channels");
                const m3uText = await response.text();
                const channels = parseM3U(m3uText);

                if (channels.length === 0) {
                    channelsContainer.innerHTML = '<div class="status-msg">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ù†ÙˆØ§Øª Ù…ØªØ§Ø­Ø©.</div>';
                } else {
                    renderChannels(channels);
                }
            } catch (error) {
                channelsContainer.innerHTML = '<div class="status-msg">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ù†ÙˆØ§Øª Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.</div>';
            }
        }

        function parseM3U(content) {
            const lines = content.split('\n');
            const channels = [];
            let currentChannel = {};

            for (let line of lines) {
                line = line.trim();
                if (line.startsWith('#EXTINF:')) {
                    const logoMatch = line.match(/tvg-logo="([^"]*)"/);
                    const logo = logoMatch ? logoMatch[1] : '';
                    const nameParts = line.split(',');
                    const name = nameParts[nameParts.length - 1].trim();
                    currentChannel = { name: name, logo: logo };
                } else if (line.startsWith('http')) {
                    currentChannel.url = line;
                    channels.push(currentChannel);
                    currentChannel = {};
                }
            }
            return channels;
        }

        function renderChannels(channels) {
            channelsContainer.innerHTML = '';
            channels.forEach(channel => {
                const div = document.createElement('div');
                div.className = 'item';
                div.innerHTML = `
                    <img src="${channel.logo}" loading="lazy" onerror="this.src='https://via.placeholder.com/40?text=TV'">
                    <span>${channel.name}</span>
                `;
                div.onclick = () => playStream(channel.url);
                div.setAttribute('data-name', channel.name.toLowerCase());
                channelsContainer.appendChild(div);
            });
        }

        function playStream(url) {
            if (!url) return;
            initPlayer(url);
            if(window.innerWidth < 768) {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function filterList(containerId, query) {
            const container = document.getElementById(containerId);
            const items = container.getElementsByClassName('item');
            const searchText = query.toLowerCase();
            for (let item of items) {
                const name = item.getAttribute('data-name');
                if (name && name.includes(searchText)) item.style.display = 'flex';
                else item.style.display = 'none';
            }
        }

        // --- Ø¯Ø§Ù„Ø© ØªÙˆÙ„ÙŠØ¯ Ù…Ø¨Ø§Ø±ÙŠØ§Øª ÙˆÙ‡Ù…ÙŠØ© Ù„Ù„Ø¹Ø±Ø¶ (Mock Data) ---
        function renderMockMatches() {
            const matchesWrapper = document.getElementById('matches-wrapper');
            // Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª
            const matches = [
                { home: "Real Madrid", away: "Barcelona", time: "22:00", logo1: "https://media.api-sports.io/football/teams/541.png", logo2: "https://media.api-sports.io/football/teams/529.png", live: false },
                { home: "Liverpool", away: "Man City", time: "Live", logo1: "https://media.api-sports.io/football/teams/40.png", logo2: "https://media.api-sports.io/football/teams/50.png", live: true },
                { home: "Bayern", away: "Dortmund", time: "20:30", logo1: "https://media.api-sports.io/football/teams/157.png", logo2: "https://media.api-sports.io/football/teams/165.png", live: false },
                { home: "PSG", away: "Marseille", time: "19:00", logo1: "https://media.api-sports.io/football/teams/85.png", logo2: "https://media.api-sports.io/football/teams/81.png", live: false },
                { home: "Juventus", away: "Milan", time: "21:45", logo1: "https://media.api-sports.io/football/teams/496.png", logo2: "https://media.api-sports.io/football/teams/489.png", live: false },
                { home: "Al Ahly", away: "Zamalek", time: "18:00", logo1: "https://media.api-sports.io/football/teams/1029.png", logo2: "https://media.api-sports.io/football/teams/1032.png", live: false }
            ];

            matchesWrapper.innerHTML = '';
            
            matches.forEach(match => {
                const timeHtml = match.live 
                    ? `<span class="live-badge">Ù…Ø¨Ø§Ø´Ø±</span>` 
                    : `<span class="match-time">${match.time}</span>`;
                
                const card = document.createElement('div');
                card.className = 'match-card';
                card.innerHTML = `
                    <div class="match-team">
                        <img src="${match.logo1}" onerror="this.src='https://via.placeholder.com/30'">
                        <span>${match.home}</span>
                    </div>
                    <div class="match-info">
                        ${timeHtml}
                        <span>VS</span>
                    </div>
                    <div class="match-team">
                        <img src="${match.logo2}" onerror="this.src='https://via.placeholder.com/30'">
                        <span>${match.away}</span>
                    </div>
                `;
                // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© ÙŠÙ…ÙƒÙ† Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù‚Ù†ÙˆØ§ØªÙ‡Ø§
                card.onclick = () => {
                    document.getElementById('search-channel').value = match.home;
                    document.getElementById('search-channel').focus();
                    filterList('channels-container', match.home);
                };
                matchesWrapper.appendChild(card);
            });
        }

        // Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø¨Ø¯Ø¦ÙŠ
        document.addEventListener('DOMContentLoaded', () => {
             player = new Plyr(videoElement, {
                controls: ['play-large', 'play', 'progress', 'current-time', 'mute', 'volume', 'fullscreen']
            });
            fetchCountries();
            renderMockMatches(); // ØªØ´ØºÙŠÙ„ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª
        });
    </script>
</body>
</html>
